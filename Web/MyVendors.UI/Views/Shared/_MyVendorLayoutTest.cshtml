<!DOCTYPE html>

<html>
<head>
    <!--meta tags-->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <title>Dashboard</title>
    <!-- favicon -->
    <!--<link rel="shortcut icon" href="../../App_Themes/Default/images/favicon.ico" type="image/x-icon">-->

    <link href="../../App_Themes/Default/css/kendo.common.min.css" rel="stylesheet" />
    <link href="../../App_Themes/Default/css/kendo.default.min.css" rel="stylesheet" />
    <link href="../../App_Themes/Default/css/fonts.css" rel="stylesheet" />
    <link href="../../App_Themes/Default/css/styleguide.css" rel="stylesheet" />
    <link href="../../App_Themes/Default/css/casepoint.comfortable.css" rel="stylesheet" />
    <link href="../../App_Themes/Default/css/kendo.Deeppurple.css" rel="stylesheet" />

    <!-- css -->
    <link href="../../App_Themes/Default/css/core-pocket.css" rel="stylesheet" />
    <link href="../../App_Themes/Default/css/core-pocket-responsive.css" rel="stylesheet" />

</head>
<body>
    <input type="hidden" id="userid" value="@ViewBag.userid" />
    <!-- BEGIN LOADER -->
    <div id="load_screen" class="load-screen">
        <div class="pre-loader">
            <div class="loader-content">
                <h5 class="text-primary">My Vendor</h5>
                <button>
                    <div class="spinner-border mr-2 align-self-center loader-sm "></div>
                    <span>Loading...</span>
                </button>
            </div>
        </div>
    </div>
    <!--  END LOADER -->
        <!-- header -->
        <header class="main-header">
            <nav class="mt-navbar">
                <div class="nav-left" id="dvLeftMenu" data-role="aratooltipv2">
                    <div class="logo-wrapper">
                        <img src="~/logo/White_logo.png" />
                    </div>
                    @*<ul class="left-menu list-unstyled list-inline">
                        <li class="separator"></li>
                        <li class="active project-item"><a class="noPointer ellipsis" title="CorePocket">CorePocket</a></li>
                    </ul>*@
                </div>
                <div class="nav-right">
                    <ul class="user-menu">
                        <li class="support-mail-wrapper">
                            <a href="javascript:void(0)" class="help">
                                <span class="icon"><i class="icon-help"></i></span>
                            </a>
                        </li>
                        <li class="notification-item item">
                            <a href="javascript:void(0)">
                                <span class="icon"><i class="icon-notification"></i></span>
                                <span class="counts">12</span>
                            </a>
                        </li>
                        <li class="separator"></li>
                        <li class="userprofile-item userprofile dropdown">
                            <a href="javascript:void(0)">
                                <span class="navuser-ellipse" id="lblemail1"></span>
                                <span class="dw-icon"><i class="icon-arrow-down"></i></span>
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>
        </header>
        <!-- #header -->
        <!--navigation pages-->
        <nav class="mt-navbar-pages">
            <ul class="list-inline pages-menu">
                <li id="Dashboard" class="active" >@Html.ActionLink("Dashboard", "Dashboard", "Dashboard")</li>
                <li class="dropdown">
                    <a>
                        <span>Master</span>
                    </a>
                    <ul class="dropdown-menu">
                        <li>
                            @Html.ActionLink("Category", "Category", "Dashboard")
                        </li>
                        <li>
                            @Html.ActionLink("Sub Category", "SubCategory", "Dashboard")
                        </li>
                        <li>
                            @Html.ActionLink("Vendors", "VendorDetails", "Dashboard")
                        </li>
                    </ul>
                </li>
                <li id="SubCategory" class=""></li>
                <li id="Vendors" class=""></li>
            </ul>
        </nav>
        <!--#navigation pages-->
        <!-- user profile -->

    
        <div class="userprofile-menu dropdown-menu">
            <div class="usermenu-wrap">
                <div class="main-up">
                    <div class="userprofile-content-wrapper1">
                        <div class="brief">
                            <div class="profileLetterDiv img-circle"><span id="imguser"></span></div>
                            <div class="ImgDiv img-circle" id="ViewDiv"><img id="ViewProfileImage" /></div>
                        </div>
                        <div class="a-box">
                            <a id="settings">
                                <i class="icon-setting"></i><span class="text-dark text-semibold">Settings</span>
                            </a>
                            <a href="/Login/Logout" class="bl-0">
                                <i class="icon-logout text-danger"></i><span class="text-dark text-semibold" id="btnLogout">Logout</span>
                            </a>
                        </div>
                        <div class="bottom-block">
                            <div class="userprofile-info d-flex align-items-center">
                                <span class="userprofile-info-icon"><i class="icon-user"></i></span>
                                <div class="flex-1 overflow-hidden font-semi-bold ml-15">
                                    <span class="text-muted d-block ellipsis mb-5">Username</span>
                                    <label class="text-dark d-block ellipsis fs-15" id="lbluname"></label>
                                </div>
                            </div>
                            <div class="userprofile-info d-flex align-items-center">
                                <span class="userprofile-info-icon"><i class="icon-user"></i></span>
                                <div class="flex-1 overflow-hidden font-semi-bold ml-15">
                                    <span class="text-muted d-block ellipsis mb-5">Full Name</span>
                                    <label class="text-dark d-block ellipsis fs-15" id="lblfullname"></label>
                                </div>
                            </div>
                            <div class="userprofile-info d-flex align-items-center">
                                <span class="userprofile-info-icon"><i class="icon-email"></i></span>
                                <div class="flex-1 overflow-hidden font-semi-bold ml-15">
                                    <span class="text-muted d-block ellipsis mb-5">Email</span>
                                    <label class="text-dark d-block ellipsis fs-15" id="lblemail"></label>
                                </div>
                            </div>
                            <div class="userprofile-info d-flex align-items-center">
                                <span class="userprofile-info-icon"><i class="icon-mobile"></i></span>
                                <div class="flex-1 overflow-hidden font-semi-bold ml-15">
                                    <span class="text-muted d-block ellipsis mb-5">Phone Number</span>
                                    <label class="text-dark d-block ellipsis fs-15" id="lblmobile"></label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="settings">
                    <div class="head">
                        <a class="back"><i class="icon-arrow-left"></i></a>
                        <h3>Settings</h3>
                    </div>
                    <!-- tab strip -->
                    <div id="tabstrip" class="h100">
                        <ul>
                            <li class="k-state-active">
                                Edit Profile
                            </li>
                            <li>
                                Change Password
                            </li>
                        </ul>
                        <div>
                            <div class="setting-footer">
                                <a class="btn btn-trans close" id="btnCloseprofile">Close</a>
                                <a class="btn btn-trans ml-0" id="btnResetprofile" onclick="resetEventProfile()">Reset</a>
                                <a class="btn btn-primary" id="btnUpdateprofile" onclick="UpdateProfile()">Update</a>
                            </div>
                            <form class="edit-profile" method="post" enctype="multipart/form-data">
                                <div class="brief">
                                    <div class="profileLetterDiv img-circle" id="LetterDiv"><span id="imguser1"></span></div>
                                    <div class="ImgDiv img-circle" id="EditDiv"><img id="EditProfileImage" style="display:none;" /></div>
                                    <span class="input-pic">
                                        <input type="file" id="fileProfileImage" name="fileProfileImage" onchange="SetImage(event);" title="Change Photo">
                                        <i class="icon-photo"></i>Change Photo
                                    </span>
                                    <a onclick="ResetProfile();"><i class="icon-delete"></i>Reset Photo</a>
                                </div>
                                <div class="edit-profile-details">
                                    <div class="form-group">
                                        <label>User Name</label>
                                        <input class="form-control" readonly type="text" value="" id="txtuname" />
                                    </div>
                                    <div class="form-group">
                                        <div class="half">
                                            <label>First Name</label>
                                            <input class="form-control" type="text" value="" id="txtfname" />
                                            <span id="firstNameValidateMessage"></span>
                                        </div>
                                        <div class="half">
                                            <label>Last Name</label>
                                            <input class="form-control" type="text" value="" id="txtlname" />
                                            <span id="lastNameValidateMessage"></span>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label>Email</label>
                                        <input class="form-control" type="email" readonly value="" id="txtemail" />
                                    </div>
                                    <div class="form-group">
                                        <label>Phone Number</label>
                                        <input class="form-control" type="text" value="" id="txtmobile" />
                                        <span id="mobileValidateMessage"></span>
                                    </div>
                                    @*<div class="form-group">
                                        <label for="drop-list">User Role</label>
                                        <select id="UserRoleDropdown" title="dropdown without search">
                                            <option>Scrum</option>
                                            <option>iAudit</option>
                                            <option>CorPocket</option>
                                        </select>
                                    </div>*@
                                </div>
                            </form>
                        </div>
                        <div>
                            <div>
                                <form class="edit-profile">
                                    <div class="edit-profile-details">
                                        <div class="form-group">
                                            <label>Current Password</label>
                                            <input class="form-control" type="password" placeholder="Current Password" id="txtOldPassword" />
                                            <span id="oldpasswordValidateMessage"></span>
                                        </div>
                                        <div class="form-group">
                                            <label>New Password <i class="icon-info-unfill text-muted"></i> </label>
                                            <input class="form-control" type="password" placeholder="New Password" id="txtNewPassword" />
                                            <span id="newpasswordValidateMessage"></span>
                                        </div>
                                        <div class="form-group">
                                            <label>Confirm Password</label>
                                            <input class="form-control" type="password" placeholder="Re-type New Password" id="txtConfirmPassword" />
                                            <span id="copasswordValidateMessage"></span>
                                        </div>
                                    </div>
                                </form>
                            </div>
                            <div class="setting-footer">
                                <a class="btn btn-trans close" id="btnClose">Close</a>
                                <a class="btn btn-trans ml-0" id="btnReset" onclick="resetEvent()">Reset</a>
                                <a class="btn btn-primary" id="btnSave">Save</a>
                            </div>
                        </div>
                    </div>
                    <!--  -->
                </div>
            </div>
        </div>
        <!-- end user profile -->
        <!-- main content -->
        @*<div class="main-content">
            <iframe id="iframe" style="height:100%; width:100%;" tabindex="0" src="category-iframe.html"></iframe>
        </div>*@
        <!-- ##end main content -->
    <script type="text/x-kendo-template" id="thumnail_template">
        <div class="thumbnail-item">
            <div class="thumbnail-item-wrapper">
                <span class="date">@DateTime.Now.Date</span>
                <div class="thumb-img">
                    <img src='../../App_Themes/Default/images/core-pocket/event.jpg' />
                </div>
                <div class="thumb-details">
                    <p class="font-medium text-dark thumb-name">
                        CP Annual</>
                        <ul class="thum-list">
                            <li class="text-muted item-list">
                                <span class="icon"><i class="icon-map"></i></span>
                                <span class="text">Akshay Nagar 1st block 1st crosss Banglore-560016</span>
                            </li>
                            <li class="text-muted item-list">
                                <span class="icon"><i class="icon-clock"></i></span>
                                <span class="text">@DateTime.Now.ToLocalTime()</span>
                            </li>
                        </ul>
                        <div class="btn-group bt-1 pt-10 text-center">
                            <a href="javascript:void(0)" class="btn btn-trans text-primary">More Details</a>
                        </div>
                </div>
            </div>
        </div>



    </script>
        <!-- footer -->
        @*<footer class="main-footer">
            <div class="footer-wrap">
                <div class="login-wrap">Login Time: <span>02-18-2019 15:12:43</span></div>
                <div class="version-wrap"><span>Casepoint v1.0.0.0</span></div>
            </div>
        </footer>*@

        <!-- footer -->
        <!-- scripts -->
        <script src="../../Scripts/Kendo/jquery.min.js"></script>
        <script src="../../Scripts/Kendo/kendo.all.min.js"></script>
        <script src="../../Scripts/CLARENT/Other/Custom/Custom.js"></script>
        <script>
        $(document).ready(function () {

            setTimeout(function () { $("#load_screen").hide(); }, 3000);
            $("select:not([multiple])").kendoDropDownList();
            //Kendo File Upload
            $("#fileProfileImage").kendoUpload({
                showFileList: false,
                multiple: false,
                localization: { select: 'Select File' }
            });

            $("#tabstrip").kendoTabStrip({
                animation: {
                    open: {
                        effects: "fadeIn"
                    }
                }
            });
        });
        </script>
    <script>

        var resetuserpass = {
            create: function () {
                oldpassword: "";
                newpassword: "";
                confirmpassword: "";

                return resetuserpass;
            }
        }
        $(document).ready(function () {
            $("#btnSave").click(function (data) {
                if(pswd())
                {
                    $(document).ready(function (){
                        $("input").change(function()
                        {
                            document.getElementById("oldpasswordValidateMessage").innerHTML = "";
                            document.getElementById("txtOldPassword").style.borderColor = "lightgrey";
                            document.getElementById("copasswordValidateMessage").innerHTML = "";
                            document.getElementById("txtNewPassword").style.borderColor = "lightgrey";
                            document.getElementById("newpasswordValidateMessage").innerHTML = "";
                            document.getElementById("txtConfirmPassword").style.borderColor = "lightgrey";
                        });
                    });

                    var newuserpass = resetuserpass.create();
                    newuserpass.oldpassword = $("#txtOldPassword").val();
                    newuserpass.newpassword = $("#txtNewPassword").val();
                    newuserpass.confirmpassword = $("#txtConfirmPassword").val();
                    $.ajax({
                        type: "Put",
                        url: "http://localhost:55032/api/Resetpassword/"+@ViewBag.id,
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        data:JSON.stringify(newuserpass),
                        success: function (data) {

                            if(data.responseText==0)
                            {
                                document.getElementById("oldpasswordValidateMessage").style.color = "red";
                                document.getElementById("txtOldPassword").style.borderColor = "red";
                                document.getElementById("oldpasswordValidateMessage").innerHTML="Current password doesn't match";
                            }
                            else
                            {
                                window.location = "/Login/logout";
                                //sessionStorage.clear();

                            }
                        },
                        // End  Ajax success function

                        failure: function (data) {
                            alert("There is an problem.");
                        },
                        // End Ajax failure function
                        error: function(XMLHttpRequest, textStatus, errorThrown) {
                            alert("Request failed，info：" + textStatus + "  " + errorThrown);
                        }
                        // End Ajax Error function
                    });
                    //}
                    return false;
                }
                else
                {
                    return false;
                }
            });
        });

        // input onchange evant


        $(document).ready(function (){
            $("#txtOldpasword").change(function(){
                if(pswd())
                {
                    document.getElementById("txtOldpassword").style.borderColor = "lightgrey";
                    document.getElementById("oldpasswordValidateMessage").innerHTML = "";
                }
            });
        });


        $(document).ready(function (){
            $("#txtNewPassword").change(function(){
                if(pswd())
                {
                    document.getElementById("txtNewPassword").style.borderColor = "lightgrey";
                    document.getElementById("newpaswordValidateMessage").innerHTML = "";
                }
            });
        });

        $(document).ready(function (){
            $("#txtConfirmPassword").change(function(){
                if(pswd())
                {
                    document.getElementById("txtConfiemPassword").style.borderColor = "lightgrey";
                    document.getElementById("copaswordValidateMessage").innerHTML = "";
                }
            });
        });


        $(document).ready(function (){
            $("input").change(function(){
                if(name())
                {
                    document.getElementById("txtfname").style.borderColor = "lightgrey";
                    document.getElementById("txtlname").style.borderColor = "lightgrey";
                    document.getElementById("lastNameValidateMessage").innerHTML = "";
                    document.getElementById("firstNameValidateMessage").innerHTML = "";
                    document.getElementById("txtmobile").style.borderColor = "lightgrey";
                    document.getElementById("mobileValidateMessage").innerHTML = "";
                }
            });
        });

        $(document).ready(function () {
            $("#btnUpdateprofile").click(function (data) {
                if(name())
                {
                    // anuja's code here;
                }
            });
        });

        $(document).ready(function () {
            $("#btnLogout").click(function (data) {
                sessionStorage.clear();
                window.Location("LogIn/LogIn");
            });
        });



         $(document).ready(function () {
             LoadProfile();
         });

         function LoadProfile(){
             $.ajax({
                 url : "http://localhost:55032/api/UserProfileApi/" + @ViewBag.id,
                 method : "GET",
                 success : function(data){
                     if(data.ProfilePhoto == null)
                     {
                         var profile=data.Fname[0].toUpperCase()+data.Lname[0].toUpperCase();
                         $(".ImgDiv").css("display", "none");
                         $(".profileLetterDiv").css("display", "block");
                         $(".ProfileImage").attr('src','');
                         ProfileName=profile;
                         document.getElementById("imguser").innerHTML=profile;
                         document.getElementById("imguser1").innerHTML=profile;
                     }
                     else
                     {
                         var profile=data.FirstName[0].toUpperCase()+data.LastName[0].toUpperCase();
                         document.getElementById("imguser").innerHTML=profile;
                         document.getElementById("imguser1").innerHTML=profile;
                         $(".profileLetterDiv").css("display", "none");

                         $(".ImgDiv").css("display", "block");
                         $("#ViewProfileImage").removeAttr("src").fadeIn("fast").attr('src','http://localhost:55032/Images/Profile/'+data.ProfilePhoto);
                         $("#EditProfileImage").removeAttr("src").fadeIn("fast").attr('src','http://localhost:55032/Images/Profile/'+data.ProfilePhoto);
                     }

                     document.getElementById("lblemail1").innerText=data.Fname+"  "+data.Lname;
                     document.getElementById("lblemail").innerText=data.Email;
                     document.getElementById("lblfullname").innerText=data.Fname+"  "+data.Lname;
                     document.getElementById("lbluname").innerText=data.Email;
                     document.getElementById("lblmobile").innerHTML=data.Contact;


                     document.getElementById("txtuname").value=data.Email;
                     document.getElementById("txtfname").value=data.Fname;
                     document.getElementById("txtlname").value=data.Lname;
                     document.getElementById("txtemail").value=data.Email;
                     document.getElementById("txtmobile").value=data.Contact;

                 },
                 error : function (err){
                     console.log(err)
                 }
             });
         }

        var tempImage;

        function UpdateProfile() {

            if(name())
            {
                var UserData=User.create();
                UserData.Fname=$("#txtfname").val();
                UserData.Lname=$("#txtlname").val();
                UserData.Contact=$("#txtmobile").val();
                UserData.Cid=$("#userid").val();

                $.ajax({
                    url: "http://localhost:55032//api/UserProfileApi/"+$("#userid").val(),
                    method: "PUT",
                    data : UserData,
                    success : function (data){

                        LoadContact();
                        $('.settings').removeClass('open');
                        $('.main-up').removeClass('close');


                    },
                    error : function(err){
                        console.log(err)
                    }
                });

                if(!(typeof(tempImage)==='undefined'))
                {
                    AddImage();
                    location.reload();
                }

            }

        }

        function AddImage() {

            var fileUpload = $("#fileProfileImage").get(0);
            var files = fileUpload.files;

            var fileData = new FormData();

            for (var i = 0; i < files.length; i++) {
                fileData.append(files[i].name, files[i]);
            }

            fileData.append(tempImage.name, tempImage);
            //formData.append("fileName", );
            ////formData.append("file", $("#fileProfileImage")[0].files[0]);
            $.ajax({
                url: 'http://localhost:55032/api/UserProfileApi/'+$("#userid").val(),
                type: 'POST',
                data: fileData,
                cache: false,
                contentType: false,
                processData: false,
                success: function (fileName) {
                },

            });

        }

        function SetImage() {
            tempImage = event.target.files[0];
            var filePath = $('#addtrainerimage').val();
            var tmppath = URL.createObjectURL(event.target.files[0]);
            
        }
        var User= {
            create:function(){
                Fname:"";
                Lname:"";
                MobileNo:"";
                Cid:"";

                return User;
            }
        }
        var tempImage;
        $(document).ready(function () {
            $("#btnUpdateprofile").click(function (data) {
                if(name())
                {
                    var UserData = User.create();
                    UserData.Fname = $("#txtfname").val();
                    UserData.Lname = $("#txtlname").val();
                    UserData.MobileNo = $("#txtmobile").val();

                    UserData.Cid = @ViewBag.id;
                    $.ajax({
                        url : "http://localhost:55032/api/UserProfileApi/" + @ViewBag.id,
                        method : "PUT",
                        data : UserData,
                        success : function (data){
                            functionsuccess()
                            LoadProfile();

                        },
                        error : function(err){
                            console.log(err)
                        }
                    });

                    if(!(typeof(tempImage)==='undefined'))
                    {
                        AddImage();
                        location.reload();
                    }
                }
            });
        });

        function AddImage() {

            var fileUpload = $("#fileProfileImage").get(0);
            var files = fileUpload.files;

            var fileData = new FormData();

            for (var i = 0; i < files.length; i++) {
                fileData.append(files[i].name, files[i]);
            }

            fileData.append(tempImage.name, tempImage);
            //formData.append("fileName", );
            ////formData.append("file", $("#fileProfileImage")[0].files[0]);
            $.ajax({
                url: 'http://localhost:55032/api/UserProfileApi/'+$("#userid").val(),
                type: 'POST',
                data: fileData,
                cache: false,
                contentType: false,
                processData: false,
                success: function (fileName) {
                },

            });

        }

        function ResetProfile()
        {
            $.ajax({
                url: 'http://localhost:55032/api/UserProfileApi/'+$("#userid").val(),
                type: 'DELETE',
                data:$("#userid").val(),
                success: function (data) {
                    $(".ImgDiv").css("display", "none");
                    $(".profileLetterDiv").css("display", "block");
                    $(".ProfileImage").attr('src','');

                },

            });

        }

        function SetImage()
        {
            tempImage = event.target.files[0];
            var filePath=$('#fileProfileImage').val();
            var tmppath = URL.createObjectURL(event.target.files[0]);
            $(".profileLetterDiv").css("display", "none");
            $(".ImgDiv").css("display", "block");
            $("#EditProfileImage").fadeIn("fast").attr('src',tmppath);
        }

        function functionsuccess() {
            document.getElementById("success-box").style.display = "block";

            $("#close-success").click(function (event) { document.getElementById("success-box").style.display = "none"; })
            id = "close-success"
        }

    </script>
    <!--For navigation bar set active class-->
    <script>
        $(document).ready(function() {
            $("#Dashboard").click(function () {
                $("#Category").removeClass("active");
                $("#SubCategory").removeClass("active");
                $("#Vendors").removeClass("active");
                $("#Dashboard").addClass("active");        
            });
            $("#Category").click(function () {
                $("#Dashboard").removeClass("active");
                $("#SubCategory").removeClass("active");
                $("#Vendors").removeClass("active");
                $("#Category").addClass("active");        
            });
            $("#SubCategory").click(function () {
                $("#Dashboard").removeClass("active");
                $("#Category").removeClass("active");
                $("#Vendors").removeClass("active");
                $("#SubCategory").addClass("active");        
            });
            $("#Vendors").click(function () {
                $("#Dashboard").removeClass("active");
                $("#Category").removeClass("active");
                $("#SubCategory").removeClass("active");
                $("#Vendors").addClass("active");        
            });
        });
    </script>
    <div>
        @RenderBody()
    </div>
</body>
</html>
